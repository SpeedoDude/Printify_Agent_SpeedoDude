{% extends "base.html" %}

{% block title %}Bulk Product Creator{% endblock %}

{% block content %}
<h1>Bulk Product Creator</h1>
<p>Upload a CSV file with the following columns: <code>title</code>, <code>description</code>, <code>blueprint_id</code>, <code>print_provider_id</code>, <code>variants</code>, <code>print_areas</code>.</p>
<form id="bulkCreateForm" enctype="multipart/form-data">
    <div class="form-group">
        <label for="csvFile">CSV File</label>
        <input type="file" class="form-control-file" id="csvFile" name="file" accept=".csv">
    </div>
    <button type="submit" class="btn btn-primary">Create Products</button>
</form>

<div id="results" class="mt-4" style="display: none;">
    <h2>Creation Results</h2>
    <ul id="resultList" class="list-group"></ul>
</div>

<script>
document.getElementById("bulkCreateForm").addEventListener("submit", (e) => {
    e.preventDefault();
    const formData = new FormData();
    const fileInput = document.getElementById("csvFile");
    formData.append("file", fileInput.files[0]);

    fetch("/api/bulk/create", {
        method: "POST",
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        const resultList = document.getElementById("resultList");
        resultList.innerHTML = "";
        data.forEach(item => {
            const li = document.createElement("li");
            li.className = `list-group-item ${item.status === 'success' ? 'list-group-item-success' : 'list-group-item-danger'}`;
            li.textContent = item.status === 'success' ? `Successfully created product: ${item.product_id}` : `Failed to create product. Reason: ${item.error}`;
            resultList.appendChild(li);
        });
        document.getElementById("results").style.display = "block";
    });
});
</script>
{% endblock %}
